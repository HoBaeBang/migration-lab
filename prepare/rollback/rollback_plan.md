# 마이그레이션 롤백 계획

## 1. 기본 정보
- 계획 수립일: 2024년 12월
- 담당자: [이름]
- 마이그레이션 대상: IDC MySQL → AWS RDS MySQL
- 롤백 계획 버전: v1.0

## 2. 롤백 시나리오
- **데이터 로드 실패**: 스키마 생성 또는 데이터 로드 중 오류
- **데이터 검증 실패**: IDC와 AWS 간 데이터 개수 불일치
- **성능 문제**: 응답 시간 30% 이상 저하
- **애플리케이션 오류**: 신규 환경에서 애플리케이션 동작 불안정
- **네트워크 장애**: AWS RDS 연결 불안정 또는 접근 불가

## 3. 롤백 절차
### 3.1 긴급 대응 (0-15분)
1. **AWS RDS 연결 즉시 차단**
   - 애플리케이션 설정에서 AWS 연결 비활성화
   - 새로운 연결 요청 차단
   - 진행 중인 트랜잭션 완료 대기

2. **IDC MySQL 서비스 상태 확인 및 재시작**
   - Docker 컨테이너 상태 점검
   - 필요시 MySQL 컨테이너 재시작
   - 데이터베이스 연결 가능 여부 확인

3. **애플리케이션 연결 설정 IDC로 변경**
   - 데이터베이스 연결 문자열 변경
   - 애플리케이션 서버 재시작 (필요시)
   - 연결 풀 설정 업데이트

4. **로드밸런서/프록시를 IDC로 리다이렉트**
   - Nginx 설정 변경
   - 트래픽 라우팅 규칙 수정
   - 헬스체크 엔드포인트 확인

### 3.2 데이터 동기화 (15-30분)
1. **마지막 백업 시점 확인**
   - 백업 파일 타임스탬프 확인
   - 체크섬 검증을 통한 무결성 확인
   - 백업 범위 및 완성도 점검

2. **IDC와 AWS 간 데이터 차이 분석**
   - 테이블별 레코드 수 비교
   - 마지막 업데이트 시간 확인
   - 누락된 데이터 식별

3. **필요시 최신 백업에서 수동 복구**
   - 백업 파일 검증 후 복구 실행
   - 스키마 우선 복구
   - 데이터 순차적 복구
   - 외래키 제약 조건 재설정

### 3.3 서비스 정상화 (30-60분)
1. **IDC 서비스 상태 전면 재확인**
   - MySQL 서비스 정상 동작 확인
   - 네트워크 연결 상태 점검
   - 디스크 공간 및 리소스 확인

2. **애플리케이션 헬스체크 수행**
   - 주요 기능 테스트 실행
   - API 엔드포인트 응답 확인
   - 데이터 조회/수정 테스트

3. **사용자 트래픽 IDC로 전환**
   - DNS 설정 변경 (필요시)
   - 로드밸런서 가중치 조정
   - 점진적 트래픽 전환

4. **메인터넌스 모드 해제 및 정상 서비스 재개**
   - 메인터넌스 페이지 비활성화
   - 사용자 알림 메시지 업데이트
   - 서비스 상태 모니터링 재개

## 4. 담당자 연락처
- **시스템 관리자**: [이름] - [연락처]
- **데이터베이스 관리자**: [이름] - [연락처]
- **애플리케이션 개발팀**: [이름] - [연락처]
- **인프라 운영팀**: [이름] - [연락처]
- **비상 연락망**: [응급상황 전용 연락처]

## 5. 롤백 결정 기준
- **데이터 손실 발생**
- **데이터 정합성 불일치 > 1%**
- **서비스 성능 저하 > 30%**
- **서비스 장애 지속 > 10분**
- **치명적 보안 이슈 발견**
- **복구 불가능한 시스템 오류**

## 6. 검증 항목
- [ ] 데이터 완정성 확인
- [ ] 서비스 성능 비교
- [ ] 애플리케이션 정상 동작
- [ ] 사용자 접근성 확인
- [ ] 모니터링 지표 정상
- [ ] 백업 시스템 동작
- [ ] 로그 기록 정상

## 7. 롤백 후 조치사항
1. **즉시 조치**
   - 롤백 사유 초기 분석
   - 시스템 모니터링 강화
   - 사용자 공지 (필요시)

2. **24시간 내**
   - 상세 원인 분석 보고서 작성
   - AWS 리소스 일시 중단/정리
   - 재마이그레이션 전략 수립

3. **1주일 내**
   - 팀 회고 및 개선사항 도출
   - 프로세스 개선 계획 수립
   - 문서 업데이트 및 교육

## 8. 커뮤니케이션 계획
### 내부
- 롤백 시작 즉시 관련 팀에 알림
- 30분마다 진행 상황 업데이트
- 완료 후 결과 보고

### 외부
- 사용자 대상 공지 (메인터넌스 상태)
- 경영진 보고 (중요 이슈 시)
- 외부 파트너 알림 (필요시)

## 9. 예상 리스크 및 대응 방안
### 리스크
- IDC 환경 자체의 문제
- 백업 파일 손상
- 네트워크 장애
- 인적 오류

### 대응 방안
- 다중 백업 전략
- 대체 연결 경로 준비
- 체크리스트 기반 실행
- 검증 단계 강화

## 10. 롤백 테스트 계획
- **테스트 환경 구성**: 프로덕션과 동일한 환경
- **테스트 시나리오**: 주요 실패 케이스별 대응
- **테스트 주기**: 마이그레이션 1주 전
- **테스트 결과 검토**: 전체 팀 리뷰

---

*이 문서는 마이그레이션 실행 전 팀 전체의 검토를 거쳐 승인되어야 합니다.*
